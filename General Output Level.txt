Topic: Need a general output level  (Read 27 times)  
 
aplinkrobi
Member
Posts: 5


  Need a general output level
« on: 9 Jan '04 - 13:36 »      

--------------------------------------------------------------------------------
Hi all!

On my VB6 project, I have the possibility to play several streams in the same time. Volumes can be adjusted for each stream(channel), a main stream volume can be set.

I also have a VU-meter on the form that displays the audio level of the last sample played. With BASS_ChannelGetLevel and a timer I set the value of the VU-meter display.

Now i'd like to have it displaying the general output level.
I thougt a good approach would be to get the level of each playing stream with BASS_ChannelGetLevel and the timer, add them up somehow(mix?) and then with the result set the VU display value.

Question is, how to add/mix/multiplex the level numbers coming from each channel to display them on the VU meter as a general output value?  
  Logged  
 
 
 
Chris
Member
Posts: 211

  
  Re:Need a general output level
« Reply #1 on: 9 Jan '04 - 16:41 »    

--------------------------------------------------------------------------------
hi
little Example in Delphi



function Max(const A, B: Integer): Integer;
begin
  if A > B then
    Result := A
  else
    Result := B;
end;  

procedure TForm1.SetMasterLevel;
begin
  Master_L.Position := Max(VU_Sam_L.Position, Max(Vu1_L.Position, Vu_2_L.Position)) ;
  Master_R.Position := Max(VU_Sam_R.Position, Max(Vu1_R.Position, Vu_2_R.Position)) ;
end;

 
 

Geets chris
 
« Last Edit: 9 Jan '04 - 16:42 by Chris »  Logged  
 
 
 
aplinkrobi
Member
Posts: 5


  Re:Need a general output level
« Reply #2 on: 9 Jan '04 - 17:06 »      

--------------------------------------------------------------------------------
Thanks!
Not a bad idea. But what if I have 'n' streams playing? (Could be even 32)

Thank you. Keep waitin' for suggestions.  
  Logged  
 
 
 
Chris
Member
Posts: 211

  
  Re:Need a general output level
« Reply #3 on: 9 Jan '04 - 17:45 »    

--------------------------------------------------------------------------------
the same i have here with my player (it`s possible in my player to play 200 Jingles) that i will too output to a Levelmeter
i have it make with a little trick (because 200 jingles to get with the  function above is than to slow)
create a stringList;
at the moment where one off your streams will start playing add this stream to the stringlist
Items.add(strtoint(StreamNr);
at the moment where one of the streams has end just  end delete the item

letts say you will start each Stream with a Button so we can use the Tag of the Button for our procedure



procedure TForm_Raum_1.crTimerTimer(Sender: TObject);
var
  i: integer;
  s: string;
  Level: DWORD;
  aIndex: integer;
begin
aIndex := Max(1, Sam_1.Position);
  if SampleCountList.Count >= 1 then  // our Stringlist what will hold the items of the Streams
    for i := 0 to SampleCountList.Count - 1 do begin
      s := SampleCountList.Strings[i];
      Sampler.SetSamplerVuMeter(strtoint(s), Sam_VU_L, Sam_VU_R);
      VU_Sam_L.Position := (Sam_VU_L * aIndex div 100);
      VU_Sam_R.Position := (Sam_VU_R * aIndex div 100);
    end;

  if SampleCountList.Count = 0 then begin
    VU_Sam_L.Position := 0;
    VU_Sam_R.Position := 0;
  end;



 
 


The Button Procedure



procedure TForm_Raum_1.SetSamplerButton(Sender: TObject; Button: TMouseButton;
  Shift: TShiftState; X, Y: Integer);
begin
if (Button = mbRight) then
  begin
    Sampler.Stop((Sender as TCSTBitmapButton).Tag);
    SampleCountList.Delete(SampleCountList.IndexOf(inttostr((Sender as TCSTBitmapButton).Tag)));
end
  else if (Button = mbleft) then
  begin
    Sampler.Load .........
  Sampler.Play.............
  SampleCountList.Add(inttostr((Sender as TCSTBitmapButton).Tag));
end;
end;

 
 




i have testet it wih 50 simultan Streams  the LedLevelMeter will work fine without delays

Greets chris 
 
 
